<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Archivo';
    background: #000;
    color: #fff;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .text-container {
    text-align: center;
  }

  .random-text {
    font-weight: 400;
    font-size: clamp(2.5rem, 10vw, 8rem);
    position: relative;
    color: #fff;
    cursor: default;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .random-text span {
    display: inline-block;
    position: relative;
    min-width: 0.5ch;
    will-change: contents;
  }
  span {
    opacity: 0
  }
</style>

<div class="text-container">
  <h1 class="random-text" id="randomText">
  </h1>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const textElement = document.getElementById('randomText');
    const originalText = "Built to Iterate";

    // const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()_-+=[]{}|;:,.<>?';
    const chars = 'Stglislasnrilv'

    originalText.split('').forEach(char => {
      const span = document.createElement('span');
      span.innerHTML = char === ' ' ? '&nbsp;' : char;
      textElement.appendChild(span);
      
    });

    const letters = Array.from(textElement.children);

    function createDecoderAnimation() {
      
      const tl = gsap.timeline({
        onComplete: () => {
            // gsap.delayedCall(1, () => tl.restart());
        }
      });

      letters.forEach((letter, i) => {
        const originalChar = letter.innerHTML;
        if (originalChar === '&nbsp;') return;
        let proxy = { charIndex: 0 };
        tl.to(proxy, {  
          charIndex: chars.length - 1,
          duration: 1.5,
          ease: "power2.inOut",
          onUpdate: () => {
            const randomIndex = Math.floor(Math.random() * chars.length);
            letter.textContent = chars[randomIndex];
            letter.style.opacity = 1;
          },
          onComplete: () => {
            letter.textContent = originalChar;
            console.log('finished ', i)
            if (i == letters.length - 1){
              console.log('we don reset it')
              const elements = document.querySelectorAll('span');
              gsap.killTweensOf(elements)
              // elements.forEach(element => {
                
              // });
            }
          }
        }, i * 0.1);
      });

      // tl.to({}, { duration: 2 });
    }

    createDecoderAnimation();
  });
</script>